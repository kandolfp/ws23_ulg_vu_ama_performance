<!doctype html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
   <link rel="stylesheet" href="/ws23_ulg_vu_ama_performance/libs/katex/katex.min.css">
     
   <link rel="stylesheet" href="/ws23_ulg_vu_ama_performance/libs/highlight/github.min.css">
   
    <script src="/ws23_ulg_vu_ama_performance/libs/clipboard.min.js"></script>
  
  
  <script src="/ws23_ulg_vu_ama_performance/libs/plotly-1_58_5.min.js"></script> 
  <script>
    // This function is used when calling `\fig{...}` See # Using \fig{...} below
    const PlotlyJS_json = async (div, url) => {
      response = await fetch(url); // get file
      fig = await response.json(); // convert it to json
      // Make the plot fit the screen responsively. See the documentation of plotly.js. https://plotly.com/javascript/responsive-fluid-layout/
      if (typeof fig.config === 'undefined') { fig["config"]={} }
      delete fig.layout.width
      delete fig.layout.height
      fig["layout"]["autosize"] = true
      fig["config"]["autosizable"] = true
      fig["config"]["responsive"] = true

      // make it easier to scroll throught the website rather than being blocked by a figure.
      fig.config["scrollZoom"] = false

      // PlotlyJS.savefig by default add the some more attribute to make a static plot.
      // Disable them to make the website fancier.
      delete fig.config.staticPlot
      delete fig.config.displayModeBar
      delete fig.config.doubleClick
      delete fig.config.showTips

      Plotly.newPlot(div, fig);
    };
  </script>
  
  <link rel="stylesheet" href="/ws23_ulg_vu_ama_performance/css/jtd.css">
<link rel="stylesheet" href="/ws23_ulg_vu_ama_performance/css/extras.css">
<link rel="icon" href="/ws23_ulg_vu_ama_performance/assets/favicon.ico">

<style>
  /* #148 wrap long header */
  .franklin-content a.header-anchor,
  .franklin-toc li a
   {
    word-wrap: break-word;
    white-space: normal;
  }
</style>

   <title>Parallel Computing - Exercises</title>  
</head>
<body>                      <!-- closed in foot.html -->
<div class="page-wrap">   <!-- closed in foot.html -->
  <!-- SIDE BAR -->
  <div class="side-bar">
    <div class="header">
      <a href="/ws23_ulg_vu_ama_performance/" class="title">
        Julia
      </a>
    </div>
    <label for="show-menu" class="show-menu">MENU</label>
    <input type="checkbox" id="show-menu" role="button">
    <div class="menu" id="side-menu">
      <ul class="menu-list">
        <li class="menu-list-item "><a href="/ws23_ulg_vu_ama_performance/" class="menu-list-link ">Start</a>
        <li class="menu-list-item "><a href="/ws23_ulg_vu_ama_performance/pages/hpc/" class="menu-list-link ">Parallel computing</a>
          <ul class="menu-list-child-list ">
            <li class="menu-list-item "><a href="/ws23_ulg_vu_ama_performance/pages/hpc/performance/" class="menu-list-link ">Measuring performance</a>
            <li class="menu-list-item "><a href="/ws23_ulg_vu_ama_performance/pages/hpc/simd/" class="menu-list-link ">Single Instruction Multiple Data</a>
            <li class="menu-list-item "><a href="/ws23_ulg_vu_ama_performance/pages/hpc/pi/" class="menu-list-link ">&pi; example</a>
            <li class="menu-list-item "><a href="/ws23_ulg_vu_ama_performance/pages/hpc/multithreading/" class="menu-list-link ">Multithreading</a>
            <li class="menu-list-item "><a href="/ws23_ulg_vu_ama_performance/pages/hpc/distributed/" class="menu-list-link ">Distributed computing</a>
            <li class="menu-list-item "><a href="/ws23_ulg_vu_ama_performance/pages/hpc/gpu/" class="menu-list-link ">GPU computing</a>
          </ul>
        <li class="menu-list-item "><a href="/ws23_ulg_vu_ama_performance/pages/remote-computing/" class="menu-list-link ">Remote computing</a>
          <ul class="menu-list-child-list ">
            <li class="menu-list-item "><a href="/ws23_ulg_vu_ama_performance/pages/remote-computing/history" class="menu-list-link ">History</a>
            <li class="menu-list-item "><a href="/ws23_ulg_vu_ama_performance/pages/remote-computing/hpc/" class="menu-list-link ">High Performance Computing</a>
            <ul class="menu-list-child-list ">
              <li class="menu-list-item "><a href="/ws23_ulg_vu_ama_performance/pages/remote-computing/hpc/basics" class="menu-list-link ">Basics</a>
              <li class="menu-list-item "><a href="/ws23_ulg_vu_ama_performance/pages/remote-computing/hpc/architecture" class="menu-list-link ">Architecture</a>
              <li class="menu-list-item "><a href="/ws23_ulg_vu_ama_performance/pages/remote-computing/hpc/usage" class="menu-list-link ">Usage</a>
            </ul>
            <li class="menu-list-item "><a href="/ws23_ulg_vu_ama_performance/pages/remote-computing/cloud/" class="menu-list-link ">Cloud Computing</a>
              <ul class="menu-list-child-list ">
                <li class="menu-list-item "><a href="/ws23_ulg_vu_ama_performance/pages/remote-computing/cloud/basics" class="menu-list-link ">Basics</a>
                <li class="menu-list-item "><a href="/ws23_ulg_vu_ama_performance/pages/remote-computing/cloud/architecture" class="menu-list-link ">Architecture</a>
                <li class="menu-list-item "><a href="/ws23_ulg_vu_ama_performance/pages/remote-computing/cloud/setup_vhpc" class="menu-list-link ">Setup vHPC</a>
              </ul>
            <li class="menu-list-item "><a href="/ws23_ulg_vu_ama_performance/pages/remote-computing/notes/" class="menu-list-link ">Notes</a>
          </ul>
          <li class="menu-list-item "><a href="/ws23_ulg_vu_ama_performance/pages/exercises/" class="menu-list-link active">Exercises</a>
      </ul>
    </div>
    <div class="footer">
      This is <em>Just the docs</em>, adapted from the <a href="https://github.com/pmarsceill/just-the-docs" target="_blank">Jekyll theme</a>.
    </div>
  </div>
  <!-- CONTENT -->
  <div class="main-content-wrap"> <!-- closed in foot.html -->
    <div class="main-content">    <!-- closed in foot.html -->
      <div class="main-header">
        WS23 971007 VU Advanced Methods and its Applications - Performance topics
      </div>



<!-- Content appended here (in class franklin-content) -->
<div class="franklin-content"><h1 id="exercises"><a href="#exercises" class="header-anchor">Exercises</a></h1>
<p>Please find below the exercise sheet for this lecture.</p>
<h2 id="julia_optimize_your_code"><a href="#julia_optimize_your_code" class="header-anchor">Julia optimize your code</a></h2>
<p>Optimize the following code as much as possible, while still achieving the same result. Use comments to explain your changes in the code. You can use everything that you have learned in this lecture or somewhere else. If you feel like changing the interface to the function that is fine as well.</p>
<p>The points/mark will be based on your improvements and not on the final runtime. If you use GPUs try to reduce vendor specifics as much as possible but if it helps performance go for it.</p>
<p>As context for the example please have a look at <a href="https://en.wikipedia.org/wiki/Julia_set">Julia set</a> and the skeleton for the example as</p>
<pre><code class="julia hljs"><span class="hljs-keyword">using</span> Base.Threads, BenchmarkTools, Plots

<span class="hljs-keyword">function</span> juliaset_naive(input, c)
    result_image = zeros(height, width)

    <span class="hljs-keyword">for</span> idx <span class="hljs-keyword">in</span> eachindex(input)
        z = input[idx]
        foundval = <span class="hljs-literal">false</span>

        <span class="hljs-keyword">for</span> it <span class="hljs-keyword">in</span> <span class="hljs-number">1</span>:maxiter
            <span class="hljs-keyword">if</span> abs2(z) &gt; <span class="hljs-number">4</span>
                result_image[idx] = (it - <span class="hljs-number">1</span>)
                foundval = <span class="hljs-literal">true</span>
                <span class="hljs-keyword">break</span>
            <span class="hljs-keyword">end</span>

            z = z * z + c
        <span class="hljs-keyword">end</span>

        <span class="hljs-keyword">if</span> !foundval
            result_image[idx] = maxiter
        <span class="hljs-keyword">end</span>
    <span class="hljs-keyword">end</span>

    <span class="hljs-keyword">return</span> result_image
<span class="hljs-keyword">end</span>


<span class="hljs-comment"># SETUP START</span>
scale = <span class="hljs-number">500.0</span> <span class="hljs-comment"># the greater the more details</span>
width = <span class="hljs-number">2000</span>
height = <span class="hljs-number">1000</span>

x = -<span class="hljs-number">0.8</span>
y = <span class="hljs-number">0.156</span>

maxiter = <span class="hljs-number">255</span>
<span class="hljs-comment"># SETUP END</span>

c = x + y * <span class="hljs-literal">im</span>
xvalues = <span class="hljs-built_in">LinRange</span>(-width / <span class="hljs-number">2</span>, width / <span class="hljs-number">2</span>, width) ./ scale
yvalues = <span class="hljs-built_in">LinRange</span>(-height / <span class="hljs-number">2</span>, height / <span class="hljs-number">2</span>, height) ./ scale
inputmatrix = xvalues&#x27; .+ yvalues .* <span class="hljs-literal">im</span>


<span class="hljs-meta">@btime</span> juliaset_naive(inputmatrix, c)

result = juliaset_naive(inputmatrix, c)
heatmap(xvalues, yvalues, result, aspect_ratio=<span class="hljs-literal">true</span>)</code></pre>
<p>Please hand in some kind of protocol &#40;e.g. in markdown&#41; where you document your code, the runtime of the <code>juliaset_naive</code> function vs. your implementation on your machine and a working copy of your code.</p>
<h2 id="hpc_cluster"><a href="#hpc_cluster" class="header-anchor">HPC Cluster</a></h2>
<p>With the docker compose setup of the Slurm-Cluster run the <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>π</mi></mrow><annotation encoding="application/x-tex">\pi</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.4306em;"></span><span class="mord mathnormal" style="margin-right:0.03588em;">π</span></span></span></span> exercises and examples from the <a href="https://kandolfp.github.io/ws23_ulg_vu_ama_performance/pages/hpc/distributed/">Distributed Computing</a> section.</p>
<p>Please hand in the the job files along with the code you used and the job result files.</p>
<p>The points/mark will be based on the files you hand in and if the jobs can be run on the test setup or not. </p>
<h2 id="additional_exercises"><a href="#additional_exercises" class="header-anchor">Additional exercises</a></h2>
<p>Here are some additional exercises/suggestions in case you want to play around with your HPC cluster.</p>
<ol>
<li><p>Add/remove workers from your cluster &#40;you need to change the <code>docker-compose.yml</code> and <code>slurm.conf</code> files&#41;.</p>
</li>
<li><p>Additionally to Julia 1.9.4 install 1.10.0 and switch between them via the <code>module</code> environment &#40;use <code>julia --version</code> to test&#41;.</p>
</li>
<li><p>Install some additional software &#40;e.g. <code>python</code>, <code>R</code>&#41; and create the necessary module files &#40;The image is based on Rocky Linux, a RedHat based Linux&#41;.</p>
</li>
<li><p>Try changing to 2 CPUs per worker &#40;depending on your hardware you might need to reduce workers&#41;</p>
</li>
<li><p>Can be tricky: try to include a GPU into the setup.</p>
</li>
<li><p>Change the <code>SelectType</code> and therefore how resources can be consumed, see <a href="https://slurm.schedmd.com/cons_tres_share.html">docs</a>.</p>
</li>
</ol>
<div class="page-foot">
    <a href="http://creativecommons.org/licenses/by-nc-sa/4.0/">CC BY-NC-SA 4.0</a> - <a href="https://ehrensperger.dev/">Gregor Ehrensperger</a>, <a href="https://orcid.org/0000-0003-3601-0852">Peter Kandolf</a>. Last modified: January 15, 2024.
    Website built with <a href="https://github.com/tlienart/Franklin.jl">Franklin.jl</a> and the <a href="https://julialang.org">Julia programming language</a>.
</div>
</div><!-- CONTENT ENDS HERE -->
    </div> <!-- end of class main-content -->
    </div> <!-- end of class main-content-wrap -->
    </div> <!-- end of class page-wrap-->
    
      



    
    
      


      <script>
    (function(){
    
      // Get the elements.
      // - the 'pre' element.
      // - the 'div' with the 'paste-content' id.
    
      var pre = document.getElementsByTagName('pre');
    
      // Add a copy button in the 'pre' element.
      // which only has the className of 'language-'.
    
      for (var i = 0; i < pre.length; i++) {
        var isLanguage = pre[i].children[0].tagName == 'CODE';
    
        if ( isLanguage ) {
          var button           = document.createElement('button');
              button.className = 'copy-button';
              button.textContent = 'Copy';
    
              pre[i].appendChild(button);
        }
      };
    
      // Run Clipboard
    
      var copyCode = new Clipboard('.copy-button', {
        target: function(trigger) {
          return trigger.previousElementSibling;
        }
      });
    
      // On success:
      // - Change the "Copy" text to "Copied".
      // - Swap it to "Copy" in 2s.
      // - Lead user to the "contenteditable" area with Velocity scroll.
    
      copyCode.on('success', function(event) {
        event.clearSelection();
        event.trigger.textContent = 'Copied';
        window.setTimeout(function() {
          event.trigger.textContent = 'Copy';
        }, 2000);
    
      });
    
      // On error (Safari):
      // - Change the  "Press Ctrl+C to copy"
      // - Swap it to "Copy" in 2s.
    
      copyCode.on('error', function(event) {
        event.trigger.textContent = 'Press "Ctrl + C" to copy';
        window.setTimeout(function() {
          event.trigger.textContent = 'Copy';
        }, 5000);
      });
    
    })();
</script>
    
  </body>
</html>

<script>
  var coll = document.getElementsByClassName("collapsible");
  var i;

  for (i = 0; i < coll.length; i++) {
    coll[i].addEventListener("click", function() {
      this.classList.toggle("active");
      var content = this.nextElementSibling;
      if (content.style.display === "block") {
        content.style.display = "none";
      } else {
        content.style.display = "block";
      }
    });
  }
</script>

<script>
  var coll = document.getElementsByClassName("solutioncollapsible");
  var sols = document.getElementsByClassName("solution");
  
  const queryString = window.location.search;
  const urlParams = new URLSearchParams(queryString);
  const myVar = urlParams.get('solution')

  if ( myVar == 'true') {
    for (i = 0; i < coll.length; i++) {
      coll[i].style.display = "block";
    }

    for (i = 0; i < sols.length; i++) {
      sols[i].style.display = "block";
    }
  }
</script>