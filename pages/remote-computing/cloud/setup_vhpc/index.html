<!doctype html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
   <link rel="stylesheet" href="/ws23_ulg_vu_ama_performance/libs/katex/katex.min.css">
     
   <link rel="stylesheet" href="/ws23_ulg_vu_ama_performance/libs/highlight/github.min.css">
   
    <script src="/ws23_ulg_vu_ama_performance/libs/clipboard.min.js"></script>
  
  
  <script src="/ws23_ulg_vu_ama_performance/libs/plotly-1_58_5.min.js"></script> 
  <script>
    // This function is used when calling `\fig{...}` See # Using \fig{...} below
    const PlotlyJS_json = async (div, url) => {
      response = await fetch(url); // get file
      fig = await response.json(); // convert it to json
      // Make the plot fit the screen responsively. See the documentation of plotly.js. https://plotly.com/javascript/responsive-fluid-layout/
      if (typeof fig.config === 'undefined') { fig["config"]={} }
      delete fig.layout.width
      delete fig.layout.height
      fig["layout"]["autosize"] = true
      fig["config"]["autosizable"] = true
      fig["config"]["responsive"] = true

      // make it easier to scroll throught the website rather than being blocked by a figure.
      fig.config["scrollZoom"] = false

      // PlotlyJS.savefig by default add the some more attribute to make a static plot.
      // Disable them to make the website fancier.
      delete fig.config.staticPlot
      delete fig.config.displayModeBar
      delete fig.config.doubleClick
      delete fig.config.showTips

      Plotly.newPlot(div, fig);
    };
  </script>
  
  <link rel="stylesheet" href="/ws23_ulg_vu_ama_performance/css/jtd.css">
<link rel="stylesheet" href="/ws23_ulg_vu_ama_performance/css/extras.css">
<link rel="icon" href="/ws23_ulg_vu_ama_performance/assets/favicon.ico">

<style>
  /* #148 wrap long header */
  .franklin-content a.header-anchor,
  .franklin-toc li a
   {
    word-wrap: break-word;
    white-space: normal;
  }
</style>

   <title>Remote Computing - Cloud Computing - Setup vhpc</title>  
</head>
<body>                      <!-- closed in foot.html -->
<div class="page-wrap">   <!-- closed in foot.html -->
  <!-- SIDE BAR -->
  <div class="side-bar">
    <div class="header">
      <a href="/ws23_ulg_vu_ama_performance/" class="title">
        Julia
      </a>
    </div>
    <label for="show-menu" class="show-menu">MENU</label>
    <input type="checkbox" id="show-menu" role="button">
    <div class="menu" id="side-menu">
      <ul class="menu-list">
        <li class="menu-list-item "><a href="/ws23_ulg_vu_ama_performance/" class="menu-list-link ">Start</a>
        <li class="menu-list-item "><a href="/ws23_ulg_vu_ama_performance/pages/hpc/" class="menu-list-link ">Parallel computing</a>
          <ul class="menu-list-child-list ">
            <li class="menu-list-item "><a href="/ws23_ulg_vu_ama_performance/pages/hpc/performance/" class="menu-list-link ">Measuring performance</a>
            <li class="menu-list-item "><a href="/ws23_ulg_vu_ama_performance/pages/hpc/simd/" class="menu-list-link ">Single Instruction Multiple Data</a>
            <li class="menu-list-item "><a href="/ws23_ulg_vu_ama_performance/pages/hpc/pi/" class="menu-list-link ">&pi; example</a>
            <li class="menu-list-item "><a href="/ws23_ulg_vu_ama_performance/pages/hpc/multithreading/" class="menu-list-link ">Multithreading</a>
            <li class="menu-list-item "><a href="/ws23_ulg_vu_ama_performance/pages/hpc/distributed/" class="menu-list-link ">Distributed computing</a>
            <li class="menu-list-item "><a href="/ws23_ulg_vu_ama_performance/pages/hpc/gpu/" class="menu-list-link ">GPU computing</a>
          </ul>
        <li class="menu-list-item active"><a href="/ws23_ulg_vu_ama_performance/pages/remote-computing/" class="menu-list-link active">Remote computing</a>
          <ul class="menu-list-child-list ">
            <li class="menu-list-item "><a href="/ws23_ulg_vu_ama_performance/pages/remote-computing/history" class="menu-list-link ">History</a>
            <li class="menu-list-item "><a href="/ws23_ulg_vu_ama_performance/pages/remote-computing/hpc/" class="menu-list-link ">High Performance Computing</a>
            <ul class="menu-list-child-list ">
              <li class="menu-list-item "><a href="/ws23_ulg_vu_ama_performance/pages/remote-computing/hpc/basics" class="menu-list-link ">Basics</a>
              <li class="menu-list-item "><a href="/ws23_ulg_vu_ama_performance/pages/remote-computing/hpc/architecture" class="menu-list-link ">Architecture</a>
              <li class="menu-list-item "><a href="/ws23_ulg_vu_ama_performance/pages/remote-computing/hpc/usage" class="menu-list-link ">Usage</a>
            </ul>
            <li class="menu-list-item "><a href="/ws23_ulg_vu_ama_performance/pages/remote-computing/cloud/" class="menu-list-link active">Cloud Computing</a>
              <ul class="menu-list-child-list ">
                <li class="menu-list-item "><a href="/ws23_ulg_vu_ama_performance/pages/remote-computing/cloud/basics" class="menu-list-link ">Basics</a>
                <li class="menu-list-item "><a href="/ws23_ulg_vu_ama_performance/pages/remote-computing/cloud/architecture" class="menu-list-link ">Architecture</a>
                <li class="menu-list-item "><a href="/ws23_ulg_vu_ama_performance/pages/remote-computing/cloud/setup_vhpc" class="menu-list-link active">Setup vHPC</a>
              </ul>
            <li class="menu-list-item "><a href="/ws23_ulg_vu_ama_performance/pages/remote-computing/notes/" class="menu-list-link ">Notes</a>
          </ul>
          <li class="menu-list-item "><a href="/ws23_ulg_vu_ama_performance/pages/exercises/" class="menu-list-link ">Exercises</a>
      </ul>
    </div>
    <div class="footer">
      This is <em>Just the docs</em>, adapted from the <a href="https://github.com/pmarsceill/just-the-docs" target="_blank">Jekyll theme</a>.
    </div>
  </div>
  <!-- CONTENT -->
  <div class="main-content-wrap"> <!-- closed in foot.html -->
    <div class="main-content">    <!-- closed in foot.html -->
      <div class="main-header">
        WS23 971007 VU Advanced Methods and its Applications - Performance topics
      </div>



<!-- Content appended here (in class franklin-content) -->
<div class="franklin-content"><h1 id="setup_vhpc"><a href="#setup_vhpc" class="header-anchor">Setup vHPC</a></h1>
<div class="franklin-toc"><ol><li><a href="#overview">Overview</a></li><li><a href="#cloud_provider">Cloud provider</a></li><li><a href="#setup_of_the_provider">Setup of the provider</a></li><li><a href="#create_your_infrastructure">Create your infrastructure</a></li><li><a href="#configure_the_infrastructure">Configure the infrastructure</a></li><li><a href="#use_the_infrastructure">Use the infrastructure</a></li></ol></div>
<h2 id="overview"><a href="#overview" class="header-anchor">Overview</a></h2>
<p>We use the setup of the vHPC as an example of how some aspects of working with <em>the cloud</em> looks like. </p>
<h2 id="cloud_provider"><a href="#cloud_provider" class="header-anchor">Cloud provider</a></h2>
<p>In order to access resources in <em>the cloud</em> some kind of management software is needed. There are several options available, the big public clouds providers</p>
<ul>
<li><p>Amazone  <a href="https://aws.amazon.com/">aws</a></p>
</li>
<li><p>Microsoft <a href="https://azure.microsoft.com/">Azure</a></p>
</li>
<li><p>Google <a href="https://cloud.google.com/gcp/">GCP</a></p>
</li>
</ul>
<p>or an example for on premises &#40;private&#41;</p>
<ul>
<li><p><a href="https://www.openstack.org/">openstack</a></p>
</li>
</ul>
<p>Now we do not have such an infrastructure at our disposal but we can still simulate one. We do this with a somewhat powerful server and <a href="https://libvirt.org/">libvirt</a>, this will be our <em>cloud provider</em>. </p>
<h2 id="setup_of_the_provider"><a href="#setup_of_the_provider" class="header-anchor">Setup of the provider</a></h2>
<p>As mentioned before there is a management layer present and that needs to be installed. For on premise clouds this includes installing the cloud software &#40;openstack&#41; and adding servers, storage, ... to the managed resources.  In our case we install <code>libvirt</code> on Ubuntu.</p>
<h2 id="create_your_infrastructure"><a href="#create_your_infrastructure" class="header-anchor">Create your infrastructure</a></h2>
<p>Now we need to define our infrastructure.  In our case we would like to have</p>
<ul>
<li><p>one Slurm management node</p>
</li>
<li><p>several Slurm worker nodes</p>
</li>
<li><p>storage for each virtual machine</p>
</li>
<li><p>an operating system on each machine - we use Rocky Linux 8</p>
</li>
<li><p>initial setup of the nodes to allow further configuration &#40;service account&#41;</p>
</li>
<li><p>a network for all the machines</p>
</li>
</ul>
<p>We describe all of this using the descriptive language <a href="https://www.terraform.io/">Terraform</a> that is often used to define infrastructure.  Luckily for us, there is a Terraform provider for <code>libvirt</code>. </p>
<p>The actual code is <code>yml</code>, e.g. below you see the final part of defining the worker nodes.</p>
<pre><code class="yml hljs"><span class="hljs-string">resource</span> <span class="hljs-string">&quot;libvirt_domain&quot;</span> <span class="hljs-string">&quot;worker&quot;</span> {
  <span class="hljs-string">count</span>      <span class="hljs-string">=</span> <span class="hljs-string">var.count_worker_nodes</span>
  <span class="hljs-string">name</span>       <span class="hljs-string">=</span> <span class="hljs-string">&quot;${format(&quot;</span><span class="hljs-string">$</span>{<span class="hljs-string">var.os_prefix</span>}<span class="hljs-string">-$</span>{<span class="hljs-string">var.w_short</span>}<span class="hljs-string">-%02d&quot;</span>, <span class="hljs-string">count.index</span> <span class="hljs-string">+</span> <span class="hljs-number">1</span><span class="hljs-string">)</span>}<span class="hljs-string">.${var.domain}&quot;</span>
  <span class="hljs-string">memory</span>     <span class="hljs-string">=</span> <span class="hljs-string">var.memory</span>
  <span class="hljs-string">vcpu</span>       <span class="hljs-string">=</span> <span class="hljs-string">var.vcpu</span>
  <span class="hljs-string">cloudinit</span>  <span class="hljs-string">=</span> <span class="hljs-string">element(libvirt_cloudinit_disk.commoninit_worker[*].id,</span> <span class="hljs-string">count.index)</span>
  <span class="hljs-string">disk</span> {
    <span class="hljs-string">volume_id</span> <span class="hljs-string">=</span> <span class="hljs-string">element(libvirt_volume.worker</span>[<span class="hljs-string">*</span>]<span class="hljs-string">.id</span>, <span class="hljs-string">count.index)</span>
  }
  <span class="hljs-string">network_interface</span> {
    <span class="hljs-string">network_name</span> <span class="hljs-string">=</span> <span class="hljs-string">var.network</span>
    <span class="hljs-string">wait_for_lease</span> <span class="hljs-string">=</span> <span class="hljs-literal">true</span>
  }
  <span class="hljs-string">console</span> {
    <span class="hljs-string">type</span>        <span class="hljs-string">=</span> <span class="hljs-string">&quot;pty&quot;</span>
    <span class="hljs-string">target_port</span> <span class="hljs-string">=</span> <span class="hljs-string">&quot;0&quot;</span>
    <span class="hljs-string">target_type</span> <span class="hljs-string">=</span> <span class="hljs-string">&quot;serial&quot;</span>
  }
  <span class="hljs-string">console</span> {
    <span class="hljs-string">type</span>        <span class="hljs-string">=</span> <span class="hljs-string">&quot;pty&quot;</span>
    <span class="hljs-string">target_type</span> <span class="hljs-string">=</span> <span class="hljs-string">&quot;virtio&quot;</span>
    <span class="hljs-string">target_port</span> <span class="hljs-string">=</span> <span class="hljs-string">&quot;1&quot;</span>
  }
  <span class="hljs-string">graphics</span> {
    <span class="hljs-string">type</span>        <span class="hljs-string">=</span> <span class="hljs-string">&quot;spice&quot;</span>
    <span class="hljs-string">listen_type</span> <span class="hljs-string">=</span> <span class="hljs-string">&quot;address&quot;</span>
    <span class="hljs-string">autoport</span>    <span class="hljs-string">=</span> <span class="hljs-literal">true</span>
  }

  <span class="hljs-string">connection</span> {
    <span class="hljs-string">type</span>        <span class="hljs-string">=</span> <span class="hljs-string">&quot;ssh&quot;</span>
    <span class="hljs-string">private_key</span> <span class="hljs-string">=</span> <span class="hljs-string">file(&quot;~/.ssh/id_rsa&quot;)</span>
    <span class="hljs-string">user</span>        <span class="hljs-string">=</span> <span class="hljs-string">var.user_name</span>
    <span class="hljs-string">timeout</span>     <span class="hljs-string">=</span> <span class="hljs-string">&quot;2m&quot;</span>
    <span class="hljs-string">host</span>        <span class="hljs-string">=</span> <span class="hljs-string">format(&quot;$</span>{<span class="hljs-string">var.os_prefix</span>}<span class="hljs-string">-$</span>{<span class="hljs-string">var.w_short</span>}<span class="hljs-string">-%02d&quot;</span>, <span class="hljs-string">count.index</span> <span class="hljs-string">+</span> <span class="hljs-number">1</span><span class="hljs-string">)</span>
  }
  <span class="hljs-string">cpu</span> {
    <span class="hljs-string">mode</span> <span class="hljs-string">=</span> <span class="hljs-string">&quot;host-passthrough&quot;</span>
  }
<span class="hljs-string">}</span></code></pre>
<p>With our <em>Infrastructure as Code</em> we can use Terraform to deploy it and with that we have our machines.  The minimal configuration to have a service account for the next step is done via <code>cloud-init</code>.</p>
<p>This can easily be automated and is often called <strong>Infrastructure as a Service</strong> or <strong>IaaS</strong>.</p>
<h2 id="configure_the_infrastructure"><a href="#configure_the_infrastructure" class="header-anchor">Configure the infrastructure</a></h2>
<p>All we have now is a couple of virtual machines &#40;VMs&#41; running Linux on them and an account that can be accessed via <code>ssh</code>. The next step is to actually configure them into a working HPC cluster. For this we use <a href="https://www.ansible.com/">Ansible</a> from RedHat.</p>
<p>Again we write some <code>yml</code> files that do the actual configuration. More precisely we used the excellent ansible scripts provided by the <a href="https://github.com/elasticluster/elasticluster">elasticluster</a> project.  Unfortunately, this project is already a bit stale but with some adaptations it works for our setup. </p>
<p>The main idea is to define playbooks.  A playbook usually makes sure to configure a certain service, in our case the vHPC. The service has different roles so we subdivide down to roles.  For example the Slurm playbook is split into three parts:</p>
<ul>
<li><p>slurm-common <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo>→</mo></mrow><annotation encoding="application/x-tex">\to</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.3669em;"></span><span class="mrel">→</span></span></span></span> needed for both machines</p>
</li>
<li><p>slurm-master <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo>→</mo></mrow><annotation encoding="application/x-tex">\to</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.3669em;"></span><span class="mrel">→</span></span></span></span> just for the management node</p>
</li>
<li><p>slurm-worker <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo>→</mo></mrow><annotation encoding="application/x-tex">\to</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.3669em;"></span><span class="mrel">→</span></span></span></span> just for the worker nodes</p>
</li>
</ul>
<p>We can cluster the different VMs per role and run the playbook for each role.  The entire <code>elasticluster</code> is much bigger. To allow reuse we further subdivide into more specific services and tasks.  It is also possible to provide different ways for different platforms, e.g. RHEL or Debian based Linux distributions.</p>
<p>This is an excerpt of the <code>slurm.yml</code> playbook<sup id="fnref:1"><a href="#fndef:1" class="fnref">[1]</a></sup></p>
<pre><code class="yml hljs"><span class="hljs-meta">---
</span>
<span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">Slurm</span> <span class="hljs-string">master</span> <span class="hljs-string">Playbook</span>
  <span class="hljs-attr">hosts:</span> <span class="hljs-string">slurm_master</span>
  <span class="hljs-attr">roles:</span>
    <span class="hljs-bullet">-</span> <span class="hljs-attr">role:</span> <span class="hljs-string">&#x27;nis&#x27;</span>
      <span class="hljs-attr">NIS_MASTER:</span> <span class="hljs-string">&quot;<span class="hljs-template-variable">{{groups.slurm_master[0]}}</span>&quot;</span>
      <span class="hljs-attr">when:</span> <span class="hljs-string">&#x27;multiuser_cluster|default(&quot;true&quot;)|bool&#x27;</span>
    <span class="hljs-bullet">-</span> <span class="hljs-attr">role:</span> <span class="hljs-string">&#x27;nfs-server&#x27;</span>
      <span class="hljs-attr">NFS_EXPORTS:</span>
        <span class="hljs-bullet">-</span> <span class="hljs-attr">path:</span> <span class="hljs-string">&#x27;/home&#x27;</span>
          <span class="hljs-attr">clients:</span> <span class="hljs-string">&quot;<span class="hljs-template-variable">{{groups.slurm_worker + groups.slurm_submit|default([])}}</span>&quot;</span>
    <span class="hljs-bullet">-</span> <span class="hljs-string">slurm-master</span>


<span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">Slurm</span> <span class="hljs-string">worker</span> <span class="hljs-string">nodes</span> <span class="hljs-string">Playbook</span>
  <span class="hljs-attr">hosts:</span> <span class="hljs-string">slurm_worker</span>
  <span class="hljs-attr">roles:</span>
    <span class="hljs-bullet">-</span> <span class="hljs-attr">role:</span> <span class="hljs-string">&#x27;nis&#x27;</span>
      <span class="hljs-attr">NIS_MASTER:</span> <span class="hljs-string">&quot;<span class="hljs-template-variable">{{groups.slurm_master[0]}}</span>&quot;</span>
      <span class="hljs-attr">when:</span> <span class="hljs-string">&#x27;multiuser_cluster|default(&quot;true&quot;)|bool&#x27;</span>
    <span class="hljs-bullet">-</span> <span class="hljs-attr">role:</span> <span class="hljs-string">&#x27;nfs-client&#x27;</span>
      <span class="hljs-attr">NFS_MOUNTS:</span>
        <span class="hljs-bullet">-</span> <span class="hljs-attr">fs:</span> <span class="hljs-string">&#x27;<span class="hljs-template-variable">{{groups.slurm_master[0]}}</span>:/home&#x27;</span>
          <span class="hljs-attr">mountpoint:</span> <span class="hljs-string">&#x27;/home&#x27;</span>
    <span class="hljs-bullet">-</span> <span class="hljs-string">slurm-worker</span></code></pre>
<p>Ansible itself runs on the client and connects to the nodes via the service account and <code>ssh</code>. Here the different tasks are executed on the nodes and after they are finished ansible removes the tasks again, leaving a configured system, more details<sup id="fnref:2"><a href="#fndef:2" class="fnref">[2]</a></sup>.</p>
<p>This part is often summarized under the umbrella of <strong>Platform as a Service</strong>.</p>
<h2 id="use_the_infrastructure"><a href="#use_the_infrastructure" class="header-anchor">Use the infrastructure</a></h2>
<p>Now that we have <strong>deployed</strong> and <strong>configured</strong> our service we can use it. </p>

<figure style="text-align:center;">
<img src="/ws23_ulg_vu_ama_performance/assets/pages/remote-computing/cloud/vhpc.svg" style="padding:0; " alt=" Visualization of the setup for the virtual High Performance Computing System."/>
<figcaption> Visualization of the setup for the virtual High Performance Computing System.</figcaption>
</figure>

<p>Once all pieces work together the virtual HPC can be brought to life with the following sequence of commands:</p>
<pre><code class="bash hljs">terraform plan -out planfile
terraform apply -auto-approve planfile
ansible-playbook --inventory inventory.yml --become --key-file id_rsa main.yml</code></pre>
<p>and destroyed with</p>
<pre><code class="bash hljs">terraform destroy -auto-approve</code></pre>
<div class="note"><div class="title"><strong>⚠ Note</strong></div>
<div class="content">This virtual HPC will not make the Top500 ;&#41;. We will not see performance gains in comparison to running code locally, but we can get experience in how to work with a &#40;Slurm&#41; cluster.</div></div>
<p><table class="fndef" id="fndef:1">
    <tr>
        <td class="fndef-backref"><a href="#fnref:1">[1]</a></td>
        <td class="fndef-content">Original source on <a href="https://github.com/elasticluster/elasticluster/blob/master/elasticluster/share/playbooks/roles/slurm.yml">github</a></td>
    </tr>
</table>
 <table class="fndef" id="fndef:2">
    <tr>
        <td class="fndef-backref"><a href="#fnref:2">[2]</a></td>
        <td class="fndef-content"><a href="https://www.redhat.com/en/topics/automation/learning-ansible-tutorial#:~:text&#61;Ansible&#37;20works&#37;20by&#37;20connecting&#37;20to,and&#37;20removes&#37;20them&#37;20when&#37;20finished">How does Ansible work?</a></td>
    </tr>
</table>
</p>
<div class="page-foot">
    <a href="http://creativecommons.org/licenses/by-sa/4.0/">CC BY-SA 4.0</a> - <a href="https://ehrensperger.dev/">Gregor Ehrensperger</a>, <a href="https://orcid.org/0000-0003-3601-0852">Peter Kandolf</a>. Last modified: January 12, 2024.
    Website built with <a href="https://github.com/tlienart/Franklin.jl">Franklin.jl</a> and the <a href="https://julialang.org">Julia programming language</a>.
</div>
</div><!-- CONTENT ENDS HERE -->
    </div> <!-- end of class main-content -->
    </div> <!-- end of class main-content-wrap -->
    </div> <!-- end of class page-wrap-->
    
      



    
    
      


      <script>
    (function(){
    
      // Get the elements.
      // - the 'pre' element.
      // - the 'div' with the 'paste-content' id.
    
      var pre = document.getElementsByTagName('pre');
    
      // Add a copy button in the 'pre' element.
      // which only has the className of 'language-'.
    
      for (var i = 0; i < pre.length; i++) {
        var isLanguage = pre[i].children[0].tagName == 'CODE';
    
        if ( isLanguage ) {
          var button           = document.createElement('button');
              button.className = 'copy-button';
              button.textContent = 'Copy';
    
              pre[i].appendChild(button);
        }
      };
    
      // Run Clipboard
    
      var copyCode = new Clipboard('.copy-button', {
        target: function(trigger) {
          return trigger.previousElementSibling;
        }
      });
    
      // On success:
      // - Change the "Copy" text to "Copied".
      // - Swap it to "Copy" in 2s.
      // - Lead user to the "contenteditable" area with Velocity scroll.
    
      copyCode.on('success', function(event) {
        event.clearSelection();
        event.trigger.textContent = 'Copied';
        window.setTimeout(function() {
          event.trigger.textContent = 'Copy';
        }, 2000);
    
      });
    
      // On error (Safari):
      // - Change the  "Press Ctrl+C to copy"
      // - Swap it to "Copy" in 2s.
    
      copyCode.on('error', function(event) {
        event.trigger.textContent = 'Press "Ctrl + C" to copy';
        window.setTimeout(function() {
          event.trigger.textContent = 'Copy';
        }, 5000);
      });
    
    })();
</script>
    
  </body>
</html>

<script>
  var coll = document.getElementsByClassName("collapsible");
  var i;

  for (i = 0; i < coll.length; i++) {
    coll[i].addEventListener("click", function() {
      this.classList.toggle("active");
      var content = this.nextElementSibling;
      if (content.style.display === "block") {
        content.style.display = "none";
      } else {
        content.style.display = "block";
      }
    });
  }
</script>

<script>
  var coll = document.getElementsByClassName("solutioncollapsible");
  var sols = document.getElementsByClassName("solution");
  
  const queryString = window.location.search;
  const urlParams = new URLSearchParams(queryString);
  const myVar = urlParams.get('solution')

  if ( myVar == 'true') {
    for (i = 0; i < coll.length; i++) {
      coll[i].style.display = "block";
    }

    for (i = 0; i < sols.length; i++) {
      sols[i].style.display = "block";
    }
  }
</script>